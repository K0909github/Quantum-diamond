# ----------------------------------------------------------------------------------
# --- シミュレーション概要 ---
# ダイヤモンド(C)基板に対し、窒素(N)原子クラスターを照射するシミュレーション。
# ★★★ すぐに動くよう、基板とクラスターのサイズを小さくしたテスト版 ★★★
# ----------------------------------------------------------------------------------

# ------------------------ 1. 初期設定 (Initialization) ------------------------
newton          on
units           metal
atom_style      atomic
dimension       3
boundary        p p p

# ------------------------ 2. シミュレーション空間の準備 (System Definition) ------------------------
# ★★★ ボックスサイズを縮小 ★★★
# x,yは -30Å〜+30Å, zは -50Å〜+50Å
region          mybox0 block -30 30 -30 30 -50 50 units box
create_box      3 mybox0

neighbor        2.0 bin
neigh_modify    every 1 delay 0 check yes

# ------------------------ 3. 原子の配置 (Atom Definition) ------------------------
lattice         diamond 3.567

# ★★★ 基板サイズを縮小 (x,y: 50Å x 50Å, z: 厚さ30Å) ★★★
# 可動層 (タイプ1) の領域を定義します。
region          substrate_mobile block -25 25 -25 25 -20 20 units box
# 固定層 (タイプ2) の領域を定義します。基板の底面10Å分を固定層とします。
region          substrate_fixed block -25 25 -25 25 -30 -20 units box

create_atoms    1 region substrate_mobile
create_atoms    2 region substrate_fixed

mass            1 12.011  # Carbon (可動層)
mass            2 12.011  # Carbon (固定壁)
mass            3 14.007  # Nitrogen (イオン)

# --- 窒素(N)クラスターの作成 ---
# ★★★ クラスターサイズを縮小 (半径3Å) し、位置を表面に近づける (z=35) ★★★
region          cluster_region sphere 0 0 35 3.0 units box
lattice         fcc 4.0
create_atoms    3 region cluster_region

# --- グループ化 ---
group           mobile_atoms type 1   # 可動するダイヤモンド原子
group           fixed_atoms type 2    # 固定するダイヤモンド原子
group           N_cluster type 3      # 窒素クラスター

# ------------------------ 4. 初速の設定 (Initialization of Velocities) ------------------------
velocity        mobile_atoms create 300 12345 mom yes dist gaussian
velocity        fixed_atoms set 0.0 0.0 0.0
# N原子あたり約10eVに相当する速度
velocity        N_cluster set 0 0 -525 units box

# ------------------------ 5. 原子間ポテンシャルの設定 (Force Fields) ------------------------
pair_style      hybrid/overlay tersoff zbl 0.5 2.0
pair_coeff      * * tersoff SiC.tersoff C C NULL
pair_coeff      1 3 zbl 6 7  # 可動C(1) と N(3)
pair_coeff      2 3 zbl 6 7  # 固定C(2) と N(3)
pair_coeff      3 3 zbl 7 7  # N(3) と N(3)

# ------------------------ 6. シミュレーションの実行設定 (Simulation Run) ------------------------
timestep        0.0001 # (0.1 fs)

fix             hold fixed_atoms setforce 0.0 0.0 0.0
fix             f1 all nve

# ------------------------ 7. 出力設定 (Output) ------------------------
# ★★★ 出力頻度を短縮 ★★★
thermo          50
thermo_style    custom step time temp pe ke etotal

# ★★★ 出力頻度を短縮し、ファイル名を変更 ★★★
dump            N_cluster_to_C all xyz 20 N_cluster_to_Diamond_small.xyz
dump_modify     N_cluster_to_C element C C N

# ------------------------ 8. シミュレーションの実行と終了処理 (Actions) ------------------------
# ★★★ 計算ステップ数を大幅に短縮 (5000ステップ = 0.5 ps) ★★★
run             5000

undump          N_cluster_to_C
write_data      N_cluster_to_Diamond_small_final.data

print           "Small simulation finished."